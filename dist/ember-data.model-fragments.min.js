(function(){"use strict";var t=Ember;var e=DS;var r=DS.RootState;var i=DS.Model;var n=DS.Snapshot;var a=DS.Store;var s=DS.Transform;var o=Ember.get;a.reopen({buildFragment:function(t){t=this.modelFor(t);Ember.assert("The '"+t+"' model must be a subclass of DS.ModelFragment",DS.ModelFragment.detect(t));return t.create({store:this})},createFragment:function(t,e){var r=this.buildFragment(t);if(e){r.setProperties(e)}r.send("loadedData");return r}});i.reopen({_setup:function(){this._super();this._fragments={}},_createSnapshot:function(){var t=this._super.apply(this,arguments);var e=t._attributes;Ember.keys(e).forEach(function(t){var r=e[t];if(r&&typeof r._createSnapshot==="function"){e[t]=r._createSnapshot()}});return t},adapterDidCommit:function(t){this._super.apply(this,arguments);var e;for(var r in this._fragments){if(e=this._fragments[r]){e.adapterDidCommit()}}},changedAttributes:function(){var t=this._super();Ember.keys(this._fragments).forEach(function(e){if(e in this._attributes){t[e]=true}},this);return t},rollback:function(){this._super();this.rollbackFragments()},rollbackFragments:function(){for(var t in this._fragments){if(this._fragments[t]){this._fragments[t].rollback()}}},fragmentDidDirty:function(t,e){if(!o(this,"isDeleted")){this._attributes[t]=e;this.send("becomeDirty")}},fragmentDidReset:function(t,e){delete this._attributes[t];if(!o(this,"isNew")){this.send("propertyWasReset",t)}}});i.proto();var u=["_setup","_unhandledEvent","_createSnapshot","send","transitionTo","isEmpty","isLoading","isLoaded","isDirty","isSaving","isDeleted","isNew","isValid","serialize","changedAttributes","eachAttribute","fragmentDidDirty","fragmentDidReset","rollbackFragments"].reduce(function(e,r){e[r]=i.prototype[r]||t.meta(i.prototype).descs[r];return e},{});var f=["attributes","eachAttribute","transformedAttributes","eachTransformedAttribute"].reduce(function(e,r){e[r]=i[r]||t.meta(i).descs[r];return e},{});var c=t.Object.extend(u,{eachRelationship:t.K,updateRecordArraysLater:t.K});c.reopenClass(f,{eachRelationship:t.K});var l=c;var h=t.get;var d=t.set;var m=Array.prototype.splice;var p=t.ArrayProxy.extend({owner:null,name:null,init:function(){this._super();this._pendingData=undefined;d(this,"_originalState",[])},content:function(){return t.A()}.property(),setupData:function(t){if(this._pendingData===t){return}this._pendingData=t;var e=this._processData(t);d(this,"_originalState",e);this.replaceContent(0,h(this,"content.length"),e);this._pendingData=undefined},_processData:function(e){return t.makeArray(e)},_createSnapshot:function(){return this.toArray()},adapterDidCommit:function(){d(this,"_originalState",this.toArray())},isDirty:function(){return t.compare(this.toArray(),h(this,"_originalState"))!==0}.property("[]","_originalState"),rollback:function(){this.setObjects(h(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var t=h(this,"owner");var e=h(this,"name");if(this.get("isDirty")){t.fragmentDidDirty(e,this)}else{t.fragmentDidReset(e,this)}},toStringExtension:function(){return"owner("+h(this,"owner.id")+")"}});var v=p;var g=t.get;var _=r.loaded.saved.didSetProperty;var y=r.loaded.updated.uncommitted.propertyWasReset;var D=function(t){var e=g(t,"_owner");var r=g(t,"_name");if(e){e.fragmentDidDirty(r,t)}};var b={isEmpty:false,isLoading:false,isLoaded:false,isDirty:false,isSaving:false,isDeleted:false,isNew:false,isValid:true,didSetProperty:_,propertyWasReset:t.K,becomeDirty:t.K,rolledBack:t.K,empty:{isEmpty:true,loadedData:function(t){t.transitionTo("loaded.created")},pushedData:function(t){t.transitionTo("loaded.saved")}},loaded:{pushedData:function(t){t.transitionTo("saved")},saved:{setup:function(t){var e=g(t,"_owner");var r=g(t,"_name");if(!e._fragments[r]||t._isInitializing){return}if(!g(e,r+".isDirty")){e.fragmentDidReset(r,t)}},pushedData:t.K,becomeDirty:function(t){t.transitionTo("updated")}},created:{isDirty:true,setup:D},updated:{isDirty:true,setup:D,propertyWasReset:y,rolledBack:function(t){t.transitionTo("saved")}}}};function S(t,e){for(var r in e){t[r]=e[r]}return t}function F(e,r,i){e=S(r?t.create(r):{},e);e.parentState=r;e.stateName=i;for(var n in e){if(!e.hasOwnProperty(n)||n==="parentState"||n==="stateName"){continue}if(typeof e[n]==="object"){e[n]=F(e[n],e,i+"."+n)}}return e}b=F(b,null,"root");var A=b;var E=t.get;var w=l.extend(t.Comparable,t.Copyable,{_name:null,_owner:null,currentState:A.empty,setupData:function(e){var r=E(this,"store");var i=r.modelFor(this.constructor);var n=r.serializerFor(i);this._attributes={};this._data=n.normalize(i,e);this.send("pushedData");k(this,t.keys(e))},rollback:function(){var e=t.keys(this._attributes);this._attributes={};this.rollbackFragments();this.send("rolledBack");k(this,e)},compare:function(t,e){return t===e?0:1},copy:function(){var e=E(this,"store");var r=e.modelFor(this.constructor);var i={};t.merge(i,this._data);t.merge(i,this._attributes);return this.store.createFragment(r,i)},adapterDidCommit:function(){if(t.keys(this._inFlightAttributes).length){t.mixin(this._data,this._inFlightAttributes);this._inFlightAttributes={}}var e;for(var r in this._fragments){if(e=this._fragments[r]){e.adapterDidCommit()}}this.transitionTo("saved")},toStringExtension:function(){return"owner("+E(this,"_owner.id")+")"},init:function(){this._super();this._setup()}});function k(e,r){t.beginPropertyChanges();for(var i=0,n=r.length;i<n;i++){e.notifyPropertyChange(r[i])}t.endPropertyChanges()}function C(t,e,r){if(!e.polymorphic||!r){return t}var i=e.typeKey||"type";var n=r[i];return n||t}var R=w;var z=t.get;var O=t.EnumerableUtils.map;var T=v.extend({type:null,options:null,init:function(){this._super();this._isInitializing=false},_processData:function(e){var r=z(this,"owner");var i=z(r,"store");var n=z(this,"type");var a=z(this,"options");var s=z(this,"name");var o=z(this,"content");this._isInitializing=true;var u=O(t.makeArray(e),function(t,e){var u=o[e];if(!u){var f=C(n,a,t);u=i.buildFragment(f);u.setProperties({_owner:r,_name:s})}u.setupData(t);return u});this._isInitializing=false;return u},_createSnapshot:function(){return O(this,function(t){return t._createSnapshot()})},adapterDidCommit:function(){this._super();this.invoke("adapterDidCommit")},isDirty:function(){return this._super()||this.isAny("isDirty")}.property("@each.isDirty","_originalState"),rollback:function(){this._super();this.invoke("rollback")},serialize:function(){return this.invoke("serialize")},replaceContent:function(t,e,r){var i=this;var n=z(this,"owner");var a=z(this,"name");if(r){r.forEach(function(t){var e=z(t,"_owner");if(!e){t.setProperties({_owner:n,_name:a})}})}return z(this,"content").replace(t,e,r)},addFragment:function(t){return this.addObject(t)},removeFragment:function(t){return this.removeObject(t)},createFragment:function(t){var e=z(this,"owner");var r=z(e,"store");var i=z(this,"type");var n=r.createFragment(i,t);return this.pushObject(n)}});var N=T;var P=window.Ember;var x=P.computed;var K;try{P.computed({set:function(){},get:function(){}});K=true}catch(j){K=false}var I=function(){var t=[];var e=arguments[arguments.length-1];if(typeof e==="function"||K){return x.apply(this,arguments)}for(var r=0,i=arguments.length-1;r<i;r++){t.push(arguments[r])}var n;if(e.set){n=function(t,r){if(arguments.length>1){return e.set.call(this,t,r)}else{return e.get.call(this,t)}}}else{n=function(t){return e.get.call(this,t)}}t.push(n);return x.apply(this,t)};var M=t.get;function V(t,e,r){return t.setProperties({_owner:e,_name:r})}function L(t,e){e=e||{};var r={type:"fragment",isAttribute:true,isFragment:true,options:e};function i(r,i,n){var a=r.store;var s=r._data[i]||J(r,e,"object");var o=r._fragments[i];var u=C(t,e,s);if(!o&&W(a.modelFor(u),s)){o=s}else if(s&&s!==o){o||(o=V(a.buildFragment(u),r,i));r._data[i]=o;o.setupData(s)}else{o=s}return o}return I({set:function(t,e){var r=i(this,t,e);var n=this.store;r=e?V(e,this,t):null;if(this._data[t]!==r){this.fragmentDidDirty(t,r)}else{this.fragmentDidReset(t,r)}return this._fragments[t]=r},get:function(t){var e=i(this,t);return this._fragments[t]=e}}).meta(r)}function W(e,r){if(r instanceof e){return true}else if(t.MODEL_FACTORY_INJECTIONS){return r instanceof e.superclass}return false}function B(e,r){if(t.typeOf(e)!=="string"){r=e;e=null}r=r||{};var i={type:"fragment",isAttribute:true,isFragment:true,options:r,kind:"hasMany"};function n(t,i){var n=e?N:v;return n.create({type:e,options:r,name:i,owner:t})}function a(t,e,i){var a=t._data[e]||J(t,r,"array");var s=t._fragments[e]||null;if(a instanceof v&&!s){s=a}else if(a&&a!==s){s||(s=n(t,e));t._data[e]=s;s.setupData(a)}else{s=a}return s}return I({set:function(e,r){var i=a(this,e,r);if(t.isArray(r)){i||(i=n(this,e));i.setObjects(r)}else if(r===null){i=null}else{}if(this._data[e]!==i||M(i,"isDirty")){this.fragmentDidDirty(e,i)}else{this.fragmentDidReset(e,i)}return this._fragments[e]=i},get:function(t){var e=a(this,t);return this._fragments[t]=e}}).meta(i)}function U(){return t.computed.alias("_owner").readOnly()}function J(e,r,i){var n;if(typeof r.defaultValue==="function"){n=r.defaultValue()}else if(r.defaultValue){n=r.defaultValue}else{return null}return t.copy(n,true)}var Y=Ember.get;var q=Ember.isArray;var G=Ember.EnumerableUtils.map;var H=s.extend({deserialize:function(t){return t},serialize:function(t){if(!t){return null}else if(q(t)){return G(t,Q)}else{return Q(t)}}});function Q(t){if(!(t instanceof n)){return t}var e=t.modelName||t.typeKey;return Y(t,"record.store").serializerFor(e).serialize(t)}var X=H;var Z=[{name:"fragmentTransform",before:"store",initialize:function(t,e){e.register("transform:fragment",X)}}];var $=Z;function tt(t){t.ModelFragment=R;t.FragmentArray=N;t.FragmentTransform=X;t.hasOneFragment=L;t.hasManyFragments=B;t.fragmentOwner=U}var et=t.Namespace.create({VERSION:"0.3.3+be9c8c8b"});tt(et);tt(e);t.onLoad("Ember.Application",function(t){$.forEach(t.initializer,t)});if(t.libraries){t.libraries.register("Model Fragments",et.VERSION)}var rt=et}).call(this);